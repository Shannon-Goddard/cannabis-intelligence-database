name: Data Validation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate-data:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Validate API endpoints
      run: |
        python -c "
        import requests
        import json
        
        try:
            # Test API stats endpoint
            response = requests.get('https://api.loyal9.app/v1/stats', timeout=10)
            if response.status_code == 200:
                stats = response.json()
                print(f'✅ API accessible: {stats.get(\"total_strains\", 0)} strains')
                print(f'✅ Breeders: {stats.get(\"total_breeders\", 0)}')
                print(f'✅ API validation: PASSED')
            else:
                print(f'❌ API returned status {response.status_code}')
                exit(1)
        except Exception as e:
            print(f'❌ API validation failed: {e}')
            exit(1)
        "